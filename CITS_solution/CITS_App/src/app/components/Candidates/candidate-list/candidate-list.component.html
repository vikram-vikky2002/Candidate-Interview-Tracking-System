<div class="container">
  <h2>Candidates</h2>

  <!-- ========== FILTER BAR ========== -->
  <form
    class="filter-bar"
    [formGroup]="filterForm"
    (ngSubmit)="applyFilters()"
  >
    <input
      formControlName="name"
      placeholder="Search name"
      class="form-control"
    />

    <select formControlName="status" class="form-control">
      <option value="">Status</option>
      <option *ngFor="let s of statusOptions" [value]="s">{{ s }}</option>
    </select>

    <input
      formControlName="job"
      placeholder="Applied for"
      class="form-control"
    />

    <button class="btn btn--primary" type="submit">Apply</button>
    <button class="btn btn--outline" type="button" (click)="resetFilters()">
      Reset
    </button>
  </form>

  <!-- ========== COLUMN CHOOSER ========== -->
  <div class="column-chooser">
    <label *ngFor="let col of allColumns">
      <input
        type="checkbox"
        [(ngModel)]="col.visible"
        (change)="updateDisplayedColumns()"
      />
      {{ col.label }}
    </label>
  </div>

  <!-- ========== TABLE ========== -->
  <div class="table-wrapper">
  <table class="candidates-table">
    <thead>
      <tr>
        <th *ngFor="let col of displayedColumns" [ngClass]="col.key + '-col'">{{ col.label }}</th>
        <th style="width: 180px">Actions</th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let c of filteredCandidates">
        <td *ngFor="let col of displayedColumns" [ngClass]="col.key + '-col'">
          <ng-container [ngSwitch]="col.key">
            <span *ngSwitchCase="'status'" [ngClass]="statusClass(c.status)" class="status-pill">
              {{ c.status }}
            </span>
            <span *ngSwitchCase="'skills'">{{ c.skills?.join(', ') }}</span>
            <span *ngSwitchDefault>{{ c[col.key] }}</span>
          </ng-container>
        </td>

        <td class="action-col">
          <button
            class="btn btn--sm btn--outline"
            (click)="viewCandidate(c)"
            title="View details"
          >
            View
          </button>

          <button
            *ngIf="!c.hasInterview"
            class="btn btn--sm btn--primary"
            (click)="openScheduleDialog(c)"
            title="Schedule interview"
          >
            Schedule
          </button>

          <button
            *ngIf="c.hasInterview"
            class="btn btn--sm"
            (click)="openScheduleDialog(c, true)"
            title="Edit interview"
          >
            Edit Interview
          </button>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<!-- ===== MODAL ===== -->
<app-schedule-interview
  *ngIf="showDialog"
  [candidate]="selectedCandidate!"
  [editMode]="editInterview"
  (closed)="closeDialog($event)"
></app-schedule-interview>

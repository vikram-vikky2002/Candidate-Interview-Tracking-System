<div class="application-form" *ngIf="job">
    <div class="container">
      <div class="back-nav">
        <button class="btn btn--outline" (click)="goBack()">← Back to Job Details</button>
      </div>
      
      <div class="form-header">
        <h1>Apply for <span class="form-header__job-title">{{ job.title }}</span></h1>
        <p class="form-header__company">at {{ job.company }}</p>
      </div>
      
      <form [formGroup]="applicationForm" (ngSubmit)="onSubmit()" class="application-form__form">
        <!-- Personal Information Section -->
        <section class="form-section">
          <h3>Personal Information</h3>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label" for="fullName">Full Name *</label>
              <input 
                type="text" 
                id="fullName" 
                formControlName="fullName" 
                class="form-control"
                [class.error]="isFieldInvalid('fullName')">
              <div class="error-message" [class.show]="isFieldInvalid('fullName')">
                Full name is required
              </div>
            </div>
            <div class="form-group">
              <label class="form-label" for="email">Email Address *</label>
              <input 
                type="email" 
                id="email" 
                formControlName="email" 
                class="form-control"
                [class.error]="isFieldInvalid('email')">
              <div class="error-message" [class.show]="isFieldInvalid('email')">
                <span *ngIf="applicationForm.get('email')?.errors?.['required']">Email is required</span>
                <span *ngIf="applicationForm.get('email')?.errors?.['email']">Please enter a valid email address</span>
              </div>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label" for="phone">Phone Number *</label>
              <input 
                type="tel" 
                id="phone" 
                formControlName="phone" 
                class="form-control"
                [class.error]="isFieldInvalid('phone')">
              <div class="error-message" [class.show]="isFieldInvalid('phone')">
                Phone number is required
              </div>
            </div>
          </div>
        </section>
  
        <!-- Work Experience Section -->
        <section class="form-section">
          <h3>Work Experience</h3>
          <button type="button" class="btn btn--outline btn--sm" style="margin-bottom: 1rem;" (click)="toggleNoExperience()">
            {{ noExperience ? 'I have Work Experience' : 'No Work Experience' }}
          </button>
          <div formArrayName="workExperience" *ngIf="!noExperience">
            <div 
              *ngFor="let experience of workExperienceControls; let i = index" 
              [formGroupName]="i" 
              class="work-experience-entry">
              
              <div class="form-row">
                <div class="form-group">
                  <label class="form-label" [for]="'company' + i">Company Name *</label>
                  <input 
                    type="text" 
                    [id]="'company' + i" 
                    formControlName="company" 
                    class="form-control"
                    [class.error]="isFieldInvalidInArray('workExperience', i, 'company')">
                  <div class="error-message" [class.show]="isFieldInvalidInArray('workExperience', i, 'company')">
                    Company name is required
                  </div>
                </div>
                <div class="form-group">
                  <label class="form-label" [for]="'jobTitle' + i">Job Title *</label>
                  <input 
                    type="text" 
                    [id]="'jobTitle' + i" 
                    formControlName="jobTitle" 
                    class="form-control"
                    [class.error]="isFieldInvalidInArray('workExperience', i, 'jobTitle')">
                  <div class="error-message" [class.show]="isFieldInvalidInArray('workExperience', i, 'jobTitle')">
                    Job title is required
                  </div>
                </div>
              </div>
              
              <div class="form-row">
                <div class="form-group">
                  <label class="form-label" [for]="'startDate' + i">Start Date *</label>
                  <input 
                    type="date" 
                    [id]="'startDate' + i" 
                    formControlName="startDate" 
                    class="form-control"
                    [class.error]="isFieldInvalidInArray('workExperience', i, 'startDate')">
                  <div class="error-message" [class.show]="isFieldInvalidInArray('workExperience', i, 'startDate')">
                    Start date is required
                  </div>
                </div>
                <div class="form-group">
                  <label class="form-label" [for]="'endDate' + i">End Date</label>
                  <input 
                    type="date" 
                    [id]="'endDate' + i" 
                    formControlName="endDate" 
                    class="form-control"
                    [disabled]="getWorkExperienceControl(i, 'isCurrentJob')?.value">
                </div>
              </div>
              
              <div class="form-group">
                <label class="checkbox-container">
                  <input 
                    type="checkbox" 
                    [id]="'currentJob' + i" 
                    formControlName="isCurrentJob">
                  <span class="checkmark"></span>
                  Currently working here
                </label>
              </div>
              
              <div class="form-group">
                <label class="form-label" [for]="'responsibilities' + i">Key Responsibilities *</label>
                <textarea 
                  [id]="'responsibilities' + i" 
                  formControlName="responsibilities" 
                  class="form-control" 
                  rows="4"
                  [class.error]="isFieldInvalidInArray('workExperience', i, 'responsibilities')"></textarea>
                <div class="error-message" [class.show]="isFieldInvalidInArray('workExperience', i, 'responsibilities')">
                  Responsibilities are required
                </div>
              </div>
              
              <button 
                *ngIf="workExperienceControls.length > 1" 
                type="button" 
                class="btn btn--outline btn--sm" 
                (click)="removeWorkExperience(i)">
                Remove
              </button>
            </div>
            <button type="button" class="btn btn--outline" (click)="addWorkExperience()">
                + Add Another Position
            </button>
          </div>
          
          <!-- <button type="button" class="btn btn--outline" (click)="addWorkExperience()">
            + Add Another Position
          </button> -->
        </section>
  
        <!-- Education Section -->
        <section class="form-section">
          <h3>Education</h3>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label" for="degree">Degree</label>
              <input 
                type="text" 
                id="degree" 
                formControlName="degree" 
                class="form-control"
                [class.error]="isFieldInvalid('degree')">
              <!-- <div class="error-message" [class.show]="isFieldInvalid('degree')">
                Degree is required
              </div> -->
            </div>
            <div class="form-group">
              <label class="form-label" for="school">School/University</label>
              <input 
                type="text" 
                id="school" 
                formControlName="school" 
                class="form-control"
                [class.error]="isFieldInvalid('school')">
              <!-- <div class="error-message" [class.show]="isFieldInvalid('school')">
                School/University is required
              </div> -->
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label" for="graduationYear">Graduation Year</label>
              <input 
                type="number" 
                id="graduationYear" 
                formControlName="graduationYear" 
                class="form-control" 
                min="1950" 
                max="2030"
                [class.error]="isFieldInvalid('graduationYear')">
              <!-- <div class="error-message" [class.show]="isFieldInvalid('graduationYear')">
                Graduation year is required
              </div> -->
            </div>
          </div>
        </section>
  
        <!-- Skills & Qualifications Section -->
        <section class="form-section">
          <h3>Skills & Qualifications</h3>
          <div class="form-group">
            <label class="form-label" for="technicalSkills">Technical Skills *</label>
            <textarea 
              id="technicalSkills" 
              formControlName="technicalSkills" 
              class="form-control" 
              rows="4"
              [class.error]="isFieldInvalid('technicalSkills')"></textarea>
            <div class="error-message" [class.show]="isFieldInvalid('technicalSkills')">
              Technical skills are required
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label" for="yearsExperience">Years of Experience *</label>
              <input 
                type="number" 
                id="yearsExperience" 
                formControlName="yearsExperience" 
                class="form-control" 
                min="0" 
                max="50"
                [class.error]="isFieldInvalid('yearsExperience')">
              <div class="error-message" [class.show]="isFieldInvalid('yearsExperience')">
                Years of experience is required
              </div>
            </div>
          </div>
        </section>
  
        <!-- Resume Upload Section -->
        <section class="form-section">
          <h3>Resume Upload</h3>
          <div class="form-group">
            <label class="form-label">Upload Resume (PDF, DOC, DOCX - Max 5MB) *</label>
            <div class="file-upload-container">
              <div 
                class="file-drop-zone" 
                [class.dragover]="isDragOver"
                (dragenter)="onDragEnter($event)"
                (dragover)="onDragOver($event)"
                (dragleave)="onDragLeave($event)"
                (drop)="onFileDrop($event)"
                (click)="triggerFileInput()">
                
                <div class="file-drop-content">
                  <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14,2 14,8 20,8"></polyline>
                    <line x1="16" y1="13" x2="8" y2="13"></line>
                    <line x1="16" y1="17" x2="8" y2="17"></line>
                    <polyline points="10,9 9,9 8,9"></polyline>
                  </svg>
                  <p>Drop your resume here or <span class="file-browse-link">browse files</span></p>
                  <p class="file-requirements">PDF, DOC, DOCX - Maximum 5MB</p>
                </div>
                
                <input 
                  type="file" 
                  #fileInput 
                  accept=".pdf,.doc,.docx" 
                  (change)="onFileSelected($event)"
                  class="file-input">
              </div>
              
              <div class="file-info" [class.hidden]="!uploadedFile">
                <div class="file-name">{{ uploadedFile?.name }}</div>
                <div class="file-size">{{ formatFileSize(uploadedFile?.size || 0) }}</div>
                <button type="button" class="file-remove" (click)="removeFile()">×</button>
              </div>
              
              <div class="error-message" [class.show]="fileError">
                {{ fileError }}
              </div>
            </div>
          </div>
        </section>
  
        <!-- Submit Section -->
        <section class="form-section form-section--submit">
          <button 
            type="submit" 
            class="btn btn--primary btn--lg btn--full-width"
            [class.loading]="isSubmitting"
            [disabled]="isSubmitting">
            <span class="btn-text" [class.hidden]="isSubmitting">Submit Application</span>
            <span class="btn-loader" [class.hidden]="!isSubmitting">
              <div class="loading-spinner"></div>
              Submitting...
            </span>
          </button>
        </section>
      </form>
    </div>
  </div>
  
  <div *ngIf="!job && !loading" class="container">
    <div class="job-not-found" style="text-align: center; padding: 2rem;">
      <h2>Job Not Found</h2>
      <p>The job you're trying to apply for doesn't exist or has been removed.</p>
      <button class="btn btn--primary" (click)="goBack()">Return to Job Listings</button>
    </div>
  </div>
  
  <div *ngIf="loading" class="container">
    <div class="loading" style="text-align: center; padding: 2rem;">
      <div class="loading-spinner"></div>
      <p>Loading application form...</p>
    </div>
  </div>